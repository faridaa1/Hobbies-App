{% extends "api/spa/index.html" %}

{% block header_css %}
<style>
    .field-error {
        color: #e12638;
        margin-bottom: 0.2rem;
    }

    .preview-img {
        object-fit: cover;
        width: 16.2rem; /* Roughly aligns the two columns */
        height: 16.2rem;
        border-radius: 100%;
    }

    .hidden {
        display: none !important;
    }

</style>
{% endblock %}

{% block content %}
<div class="mt-5 container p-5 border">
    <h1 class="text-center mb-4">Signup</h1>
    <form method="post" action="/signup/" class="signup-form" id="signup-form" enctype="multipart/form-data">
        <div class="container">
            <div class="form-content row">
                <div class="col d-flex flex-column align-self-center">
                    {% csrf_token %}
                    {% for field in form %}
                        <!-- Profile pic - Want to render input on other side of div -->
                        {% if field.label != 'Profile picture (*.png)' %} 
                            <div class="mb-3">
                                <label id="{{field.id_for_label}}" class="form-label">{{field.label}}</label> 
                                {{field}}
                                {% if field.label == 'Password' %}
                                    <div class="form-check mt-1">
                                        <input type="checkbox" id="show-password" name="show-password" class="form-check-input"/>
                                        <label for="show-password" class="form-check-inputs">Show Password</label>
                                    </div>
                                {% endif %}
                                {% for error in field.errors %}
                                    <p class="field-error">{{error}}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="col d-flex flex-column justify-content-center align-items-center">
                    <img src="" alt="circular preview of uploaded profile picture" id="profile-preview" class="preview-img hidden"/>
                    <i class="bi bi-person-circle" style="font-size: 16rem;" id="profile-preview-placeholder"></i>
                    <div class="mb-3">
                        <label id="{{form.profile_picture.id_for_label}}" class="form-label">{{form.profile_picture.label}}</label> 
                        {{form.profile_picture}}
                        {% for error in form.profile_picture.errors %}
                            <p class="field-error">{{error}}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <button class="btn btn-primary w-100" type="submit">SIGN UP</button>
        <div class="row">
            <a href="/login" class="text-center my-3" style="color: black;">Already have an account? Log in here</a>
        </div>
    </form>
</div>
{% endblock %}

{% block js %}
<script>
    const form = document.getElementById('signup')
    const passwordInput = document.querySelector('input#id_password')
    const passwordToggle = document.getElementById('show-password')
    const profilePreview = document.getElementById('profile-preview')
    const profileImgInput = document.querySelector('input#id_profile_picture')
    const profilePlaceholder = document.getElementById('profile-preview-placeholder')

    function updateProfileSource(e) {
        // If uploaded file is cleared (undefined)
        if (e.target.files[0] === undefined) {
            // Show place holder and hide img
            profilePlaceholder.classList.remove('hidden')
            profilePreview.classList.add('hidden')
        } else {
            profilePreview.src = URL.createObjectURL(e.target.files[0]) // Creates url which can be used to access uploaded file
            // Show new image and hide placeholder
            profilePlaceholder.classList.add('hidden')
            profilePreview.classList.remove('hidden')
        }
    }

    profileImgInput.addEventListener('input', updateProfileSource)
    passwordToggle.addEventListener('input', (e) => passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password')
    form.addEventListener('submit', (e) => passwordInput.type = 'password') // Don't want it to be saved by autofill
</script>
{% endblock %}